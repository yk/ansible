- name: blacklist nouveau
  become: yes
  kernel_blacklist: name=nouveau state=present
  register: blnouveau

- include: ../../common/tasks/reboot.yml
  when: blnouveau.changed

- name: download nvidia driver installer
  get_url: url=http://us.download.nvidia.com/XFree86/Linux-x86_64/367.27/NVIDIA-Linux-x86_64-367.27.run dest={{ ansible_env.HOME }}/libsrc/nvidia.run mode=0544

- name: install nvidia driver
  become: yes
  command: "{{ ansible_env.HOME }}/libsrc/nvidia.run -s"
  args:
    creates: /usr/bin/nvidia-installer
  register: nvidiadriver

- include: ../../common/tasks/reboot.yml
  when: nvidiadriver.changed
